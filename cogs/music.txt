from discord.ext import commands
from discord_slash import cog_ext, SlashContext
from discord_slash.utils.manage_commands import create_choice, create_option
from main import client

guilds = [guild.id for guild in client.guilds]

class Music(commands.Cog):

	def __init__(self, client):
		self.client = client
	
	@cog_ext.cog_slash(
		name = 'setup',
		description = 'create or delete music channel',
		guild_ids = guilds,
		options = [
			create_option(
				name = 'option',
				description = 'select option for setting up',
				option_type = 3,
				required = True,
				choices = [
					create_choice(value = 'create', name = '✅create'),
					create_choice(value = 'delete', name = '❎delete')
				]
			)
		]
	)
	async def _setup(ctx:SlashContext, option:str):
		
		log = ctx.author.guild_permissions
		
		if log.administrator or log.manage_channels:
			channel = MusicPlayer.find(ctx.guild)

			if channel is None:
				channel = await MusicPlayer.setup(ctx.guild, ctx.bot.user.name)
				return await MusicPlayer.alert.channel_created(ctx)
			
			return await MusicPlayer.alert.channel_exist(ctx)
		
		return await MusicPlayer.alert.require_permission(ctx)


def setup(client):
	client.add_cog(Music(client))